
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sergio Carracedo - Generics in Golang 1.18</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="keywords" content="Sergio Carracedo,"> 
    <meta name="description" content="Sergio Carracedo personal Blog,At the moment of writing this post Go 1.18 wasn’t released  (the latest version for 1.18 is the Rel,"> 
    <meta name="author" content="Sergio Carracedo"> 
    <link rel="alternative" href="atom.xml" title="Sergio Carracedo" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="/css/sergiocarracedo.css">

    <meta name="description" content="At the moment of writing this post Go 1.18 wasn’t released  (the latest version for 1.18 is the Release Candidate 1), but we can still play using the playground (enabling the dev branch) or installing">
<meta property="og:type" content="article">
<meta property="og:title" content="Generics in Golang 1.18">
<meta property="og:url" content="https://sergiocarracedo.es/generics-in-golang-1.18/index.html">
<meta property="og:site_name" content="Sergio Carracedo">
<meta property="og:description" content="At the moment of writing this post Go 1.18 wasn’t released  (the latest version for 1.18 is the Release Candidate 1), but we can still play using the playground (enabling the dev branch) or installing">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://sergiocarracedo.es/images/2022/go-generics-4016522.jpg">
<meta property="article:published_time" content="2022-02-28T00:00:00.000Z">
<meta property="article:modified_time" content="2022-09-08T07:23:28.009Z">
<meta property="article:author" content="Sergio Carracedo">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://sergiocarracedo.es/images/2022/go-generics-4016522.jpg">

    <script async src='https://www.google-analytics.com/analytics.js'></script>

    <script>
      function runGA() {
        window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
        ga('create', 'UA-133459072-1', 'auto');
        ga('send', 'pageview');
      }

      function runDisqus() {
        /*var disqus_config = function () {
          this.page.url = 'https://sergiocarracedo.es/';
          this.page.identifier = 'sergiocarracedo';
        }*/
        (function() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://sergiocarracedo.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      }

      function runCookiesAllowed() {
        runGA();
        runDisqus();
      }
    </script>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<meta name="generator" content="Hexo 6.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <div id="single">
    <div id="top">
  <div class="bar" style="width: 0;"></div>
  <div class="container-fluid">
    <div class="grid-row">
      <div class="col-xs-12 col-sm-3">
        <a class="back-to-home" href="/">
          <img src="/img/sergiocarracedo.jpg" alt="Sergio Carracedo" class="image-logo"/>
          <h4>
            Sergio Carracedo
          </h4>
        </a>
      </div>
      <div class="hidden-xs hidden-lxs col-sm-6">
        <h3 class="subtitle">Generics in Golang 1.18</h3>
      </div>
    </div>
  </div>
  <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article container-fluid-1200">
  <div class="grid-row">
    <div class="main col-xs-12">
      <h1 class="title">
        Generics in Golang 1.18
      </h1>
      <div class="stuff">
        <span>February 28, 2022</span>
      </div>

      
      <div class="article-image">
        <img src="/images/2022/header_go-generics-4016522.jpg" width="1200" height="400">
      </div>
      
      <div class="content markdown">
        <p>At the moment of writing this post Go 1.18 wasn’t released  (the latest version for 1.18 is the <a target="_blank" rel="noopener" href="https://groups.google.com/g/golang-announce/c/QHL1fTc352o/m/5sE6moURBwAJ">Release Candidate 1</a>), but we can still play using the <a target="_blank" rel="noopener" href="https://go.dev/play/">playground</a> (enabling the dev branch) or installing the RC</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go install golang.org/dl/go1.18rc1@latest</span><br><span class="line">go1.18rc1 download</span><br></pre></td></tr></tbody></table></figure>
<p>One of the most interesting novelties is the <em>generics</em> in a similar way we have in other languages (C#, Java, Typescript, etc…). Generics allow us as developers, for example, to create a function that works with different types. The classical example Go uses in its blog to explain <a target="_blank" rel="noopener" href="https://go.dev/blog/why-generics">why generics</a> (highly recommended), is a function that does some operation over an array, for example, reverse the array. Now we must write the same function for different types, ex: int, float, string, etc</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">func ReverseInts(s []int) {</span><br><span class="line">    first := 0</span><br><span class="line">    last := len(s) - 1</span><br><span class="line">    for first &lt; last {</span><br><span class="line">        s[first], s[last] = s[last], s[first]</span><br><span class="line">        first++</span><br><span class="line">        last--</span><br><span class="line">    }    </span><br><span class="line">}</span><br><span class="line">func ReverseStrings(s []string) {</span><br><span class="line">    first := 0</span><br><span class="line">    last := len(s) - 1</span><br><span class="line">    for first &lt; last {</span><br><span class="line">        s[first], s[last] = s[last], s[first]</span><br><span class="line">        first++</span><br><span class="line">        last--</span><br><span class="line">    }    </span><br><span class="line">}</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>As you see the code inside the function is exactly the same for both types, only the changes the types in signature. That is not nice because we should maintain the same logic in 2, 3, or more different places.</p>
<p>How we can achieve it using generics: adding a new element to the signature between brackets <em>[<em>typeName</em> <em>constraint</em>]</em> and using this <code>T</code> definition as the argument Type<br>Like in this example:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">func Reverse[T any] (s []T) {</span><br><span class="line">    first := 0</span><br><span class="line">    last := len(s) - 1</span><br><span class="line">    for first &lt; last {</span><br><span class="line">        s[first], s[last] = s[last], s[first]</span><br><span class="line">        first++</span><br><span class="line">        last--</span><br><span class="line">    }    </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Reverse[int]([]int{1, 2, 3, 4})</span><br><span class="line">Reverse[string]([]string{"1", "2", "3", "4"})</span><br></pre></td></tr></tbody></table></figure>
<p><a target="_blank" rel="noopener" href="https://go.dev/play/p/0IrUF_f54bK?v=gotip">Try it on playground</a></p>
<p>Note you can have multiple generics in the same function even the return type can be typed: <code>func [T any, U  any](arg0 T) U</code></p>
<h2 id="Constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints</h2><p>In the examples above we are using <code>any</code> as a constraint that means all the types can be used with the function, but in most of the cases we will need to limit the types we can use the function, </p>
<p>The next simpler constraint is the union type:</p>
<p>The union type is a list of possible types: <code>int | float64</code>. In our previous example, trying to <code>Reverse</code> an array of strings will return the error <code>string does not implement int</code>. That means Go is not comparing the types themselves, is comparing the interface of the types, and that is important for the next type of constraint.</p>
<p>Imagine we want to create a function to get the minimum value in the array, we could write something like:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// Not this function only works for positive numbers. but it's for example pourpouse</span><br><span class="line">func Max[T any](values []T) T {</span><br><span class="line">  var max T </span><br><span class="line">  for _, v := range values {</span><br><span class="line">     if v &gt; max {</span><br><span class="line">        max = v</span><br><span class="line">     }</span><br><span class="line">  }</span><br><span class="line">  return max</span><br><span class="line">}</span><br><span class="line">a := []int{1, 2, 3, 4, 5}</span><br><span class="line">fmt.Println("Max:", Max[int](a))</span><br></pre></td></tr></tbody></table></figure>
<p>If we run above we will get the error <code>invalid operation: v &gt; max (type parameter T is not comparable with &gt;)</code>. That is because not all the types represented by <code>any</code> implement the operator &gt; and are not comparable.</p>
<p>We can solve this using <code>func Max[T int|string](values []T) T</code> as signature, but there is a better way: using the <code>constraints</code> package (in the moment of writting this it was removed from the standard library and moved to )(exp/constrains](<a target="_blank" rel="noopener" href="https://pkg.go.dev/golang.org/x/exp/constraints">https://pkg.go.dev/golang.org/x/exp/constraints</a>) <a target="_blank" rel="noopener" href="https://go-review.googlesource.com/c/go/+/382460/">https://go-review.googlesource.com/c/go/+/382460/</a>)</p>
<p>So we can so</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import "golang.org/x/exp/constraints"</span><br><span class="line">func Max[T constraints.Ordered](values []T) T {</span><br><span class="line">....</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Type-approximation"><a href="#Type-approximation" class="headerlink" title="Type approximation"></a>Type approximation</h2><p>Is very common in Go creating custom types from a “primitive” type</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type MyString = string</span><br></pre></td></tr></tbody></table></figure>

<p>The problem with generics is that <code>MyString</code> is not the same type as <code>string</code>, so <code>func [T string|int]MyFunc(arg T)</code> will not work with <code>MyString</code>.</p>
<p>The way to solve it is the <code>type aproximation</code>: that is a type that underlying is the type specified. Let’s see it with an example: <code>~string</code> represent any type that is a pure <code>string</code> or is string underlying as our <code>MyString</code></p>
<p><a target="_blank" rel="noopener" href="https://tip.golang.org/ref/spec#Interface_types">More info in the Go spec</a></p>
<h2 id="Generic-Structs"><a href="#Generic-Structs" class="headerlink" title="Generic Structs"></a>Generic Structs</h2><p>Go also supports generics in Structs:</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type MyGenericStruct[T string | int, U constraints.Ordered] struct {</span><br><span class="line">	id    T</span><br><span class="line">	value U</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// So this works and makes sense</span><br><span class="line">c := MyGenericStruct[int, string]{1, "2"}</span><br><span class="line">d := MyGenericStruct[string, int]{"c", 2}</span><br></pre></td></tr></tbody></table></figure>
<p>That means we can use generics in methods (but in a limited way), we can use generic in the receiver, but not in the method, this was [pushed to go 1.19]</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// Works</span><br><span class="line">func (m MyGenericStruct[T, U]) GetValue() U {</span><br><span class="line">	return m.value</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Doesn't Work</span><br><span class="line">func (m MyGenericStruct[T, U]) [A any]GetValueAndAdd(add A) U {</span><br><span class="line">	return m.value + add</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>For the methods, we could use generics defined in the struct as a roundabout, but I think is not very elegant</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type MyGenericStruct[T string | int, U constraints.Ordered, A any] struct {</span><br><span class="line">	id    T</span><br><span class="line">	value U</span><br><span class="line">}</span><br><span class="line">func (m MyGenericStruct[T, U]) [A any]GetValueAndAdd(add A) U {</span><br><span class="line">    return m.value + add</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="any"><a href="#any" class="headerlink" title="any"></a>any</h1><p>The new keyword <code>any</code> we used above it’s just an alias of <code>interface{}</code>, and we could use it in any place we were using interface{}, ex: <code>map[string]any</code></p>
<h1 id="Summarizing"><a href="#Summarizing" class="headerlink" title="Summarizing"></a>Summarizing</h1><p>In my opinion, generics in Go 1.18 are a big improvement in terms of flexibility creating reusable logic independent of the types but keeping the language robust.<br><em>Union types</em> are only allowed in the constraints so there is no ambiguity in the types as in other languages inside the function.</p>

      </div>
    </div>
  </div>
</div>

<div class="post-nav">
  <div class="container-fluid-1200">
    <div class="grid-row">
      <div class="next col-xs-6">
        
          <div class="nav-previous">
            <a href="https://sergiocarracedo.es//arquitecturas-limpias-como-necesidad/" rel="prev" class="nav-cover">
              <img src="/images/2022/teaser_arquitecturas-limpias-1650627.jpg">
            </a>

            <a href="https://sergiocarracedo.es//arquitecturas-limpias-como-necesidad/" rel="prev" class="nav-text">
              <i class="fa fa-arrow-left"></i> Las arquitecturas limpias como necesidas
            </a>
          </div>
        
      </div>
      <div class="prev col-xs-6">
        
          <div class="nav-next">
            <a href="https://sergiocarracedo.es//running-workflows-in-you-k8s-cluster-argo-workflows/" rel="next" class="nav-cover">
              <img src="/images/2021/argo-workflows/teaser_cover.jpg">
            </a>

            <a href="https://sergiocarracedo.es//running-workflows-in-you-k8s-cluster-argo-workflows/" rel="next" class="nav-text">
              Running workflows in you k8s cluster: Argo Workflows <i class="fa fa-arrow-right"></i>
            </a>
          </div>
        
      </div>
    </div>
  </div>
</div>

<div class="post-comments container-fluid-1200">
    <div id="disqus_thread">To show the comments is mandatory accept cookie policy.</div>
</div>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<div id="post-aboutme">
  <div class="me container-fluid">
    <div class="grid-row">
      <div class="col-xs-12 mb-5">
        <div class="social">
  <a href="http://www.linkedin.com/in/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-linkedin"></i>
  </a>
  <a href="mailto:hi+blog@sergiocarracedo.es" class="social-link" title="hi+blog@sergiocarracedo.es">
    <i class="fas fa-envelope"></i>
  </a>

  <a href="https://github.com/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-github"></i>
  </a>
  <a href="https://www.drupal.org/u/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-drupal"></i>
  </a>


  <a href="https://www.twitter.com/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-twitter"></i>
  </a>
  <a href="http://www.last.fm/user/gasman40" class="social-link" target="_blank">
    <i class="fab fa-lastfm"></i>
  </a>
  <a href="http://sergiocarracedo.tumblr.com/" class="social-link" target="_blank">
    <i class="fab fa-tumblr"></i>
  </a>
</div>

      </div>
    </div>
  </div>

  <div class="claim container-fluid-1440">
    <div class="grid-row">
      <div class="col-xs-12">
        <h3>Front-end and back-end developer.<br />#formula1, good conversations and small details lover.</h3>
      </div>
    </div>
  </div>

  <div class="container-fluid-1440">
    <div class="grid-row">
      <div class="col-xs-12">
        <a href="/" class="back">
          Home
        </a>
      </div>
    </div>
  </div>

</div>


    </div>


</div>

</body>
<script src="https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<script src="/js/jquery.min.js"></script>
<script src="/js/sergiocarracedo.js"></script>


<link href="https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css" rel="stylesheet">
<link href="https://cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css" rel="stylesheet">

<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
    <script>
      window.addEventListener("load", function(){
        window.cookieconsent.initialise({
          "palette": {
            "popup": {
              "background": "#004262",
              "text": "#fff"
            },
            "button": {
              "background": "#8ec760",
              "text": "#ffffff"
            }
          },
          "type": "opt-out",
          "content": {
            "message": "Este sitio usa cookies propias y de terceros para mejorar la experiencia de usuario y esas cosas.",
            "allow": "Ok, continua",
            "deny": "Nada de cookies",
            "link": "Saber más",
            "href": "https://sergiocarracedo.es/cookies.html",
          },
          "onStatusChange": function(status, chosenBefore) {
            if (status == 'allow') {
               runCookiesAllowed()
            }
          },
          "onInitialise" : function(status) {
            if (status == 'allow') {
               runCookiesAllowed()
            }
          }
        })
      });
    </script>


</html>
