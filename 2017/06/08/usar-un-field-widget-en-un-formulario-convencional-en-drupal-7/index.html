<!doctype html><html><head><meta charset=UTF-8><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><meta content="width=device-width,minimum-scale=1" name=viewport><title>Sergio Carracedo | Usar un 'field widget' en un formulario convencional en Drupal 7</title>
<meta content="yes" name=apple-mobile-web-app-capable><meta content="black-translucent" name=apple-mobile-web-app-status-bar-style><meta content="Sergio Carracedo's personal page and blog" name=description><meta content="Sergio Carracedo" name=author><link href=/favicon.png rel=icon><meta property="og:title" content="Usar un 'field widget' en un formulario convencional en Drupal 7"><meta property="og:description" content="El Form API de Drupal es muy potente, para mí es algo, que cuando programo sobre otros CMS o frameworks echo mucho en falta, por que Drupal ha conseguido que la laboriosa tarea de crear, validar, y securizar formularios, quede reducida a un &ldquo;simple&rdquo; array.
Este Form API dispone de unos tipos, que yo denominaría primitivos, y no porque&rsquo;estén anticuados, si no por que a partir de ellos se pueden crear construcciones más complejas, como hace el módulo Field, más concretamente su submódulo Field UI, que como ya sabréis es el que nos facilita la creación de los distintos tipos de campos, por ejemplo en la creación de contenido."><meta property="og:type" content="article"><meta property="og:url" content="https://sergiocarracedo.es/2017/06/08/usar-un-field-widget-en-un-formulario-convencional-en-drupal-7/"><meta property="og:image" content="https://sergiocarracedo.es/2017/06/08/usar-un-field-widget-en-un-formulario-convencional-en-drupal-7/pexels-photo-268466_0_hu161f7e86f1fcbf2b1af0c8b6bfc613ca_762458_1920x1080_fill_q75_box_center.jpeg"><meta name=twitter:image content="https://sergiocarracedo.es/2017/06/08/usar-un-field-widget-en-un-formulario-convencional-en-drupal-7/pexels-photo-268466_0_hu161f7e86f1fcbf2b1af0c8b6bfc613ca_762458_1920x1080_fill_q75_box_center.jpeg"></meta><meta property="article:section" content="blog">
<meta property="article:published_time" content="2017-06-08T00:00:00+00:00"><meta property="article:modified_time" content="2017-06-08T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"></meta>
<link rel=canonical href=https://sergiocarracedo.es/2017/06/08/usar-un-field-widget-en-un-formulario-convencional-en-drupal-7/><link href=https://sergiocarracedo.es/scss/main.df9c25ee4c710877f41c3c839cb8b49ab42cafd33e26da951f93e602ac49fcf6.css integrity="sha256-35wl7kxxCHf0HDyDnLi0mrQsr9M+JtqVH5PmAqxJ/PY=" rel=stylesheet><link href=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css rel=stylesheet type=text/css></head><body><header class=web-header><h2><a class=back-to-home href=/ title="Back to home"><i class="fas fa-home"></i><div class=back-to-home__content><span class=back-to-home__action>Back to home</span><div class=back-to-home__title><img alt="Sergio Carracedo" class=avatar src=/i/sergiocarracedo_hu6caa808ff324b89bfea4b9d7d1c850ee_80590_100x100_fit_q75_box.jpg><h4>Sergio Carracedo</h4></div></div></a></h2><div class=web-header__page-title><span>Usar un 'field widget' en un formulario convencional en Drupal 7</span></div><div class=theme-switch><i class="theme-switch__theme fas fa-sun" id=theme-switch-light title="Switch to light theme"></i>
<i class="theme-switch__theme fas fa-moon" id=theme-switch-dark title="Switch to dark theme"></i></div></header><div class=main-content><article class="post post--single"><div class="post__main wrapper-1200"><aside class=post__metadata><time class=post__date datetime=2017-06-08><i class="far fa-calendar-alt"></i> Jun 8, 2017</time><div class=post__tags></div><span class=post__reading-time><i class="far fa-clock"></i> 4 minutes read</span></aside><header class=post__header><h1 class=post__title>Usar un 'field widget' en un formulario convencional en Drupal 7</h1></header><figure class=post__cover><img src=/2017/06/08/usar-un-field-widget-en-un-formulario-convencional-en-drupal-7/pexels-photo-268466_0_hu161f7e86f1fcbf2b1af0c8b6bfc613ca_762458_1200x400_fill_q75_box_center.jpeg alt="Usar un 'field widget' en un formulario convencional en Drupal 7" width=1200 height=400></figure><div class=post__content><p>El <a href=https://api.drupal.org/api/drupal/developer%21topics%21forms_api_reference.html/7.x>Form API</a> de Drupal es muy potente, para mí es algo, que cuando programo sobre otros <em>CMS</em> o <em>frameworks</em> echo mucho en falta, por que Drupal ha conseguido que la laboriosa tarea de crear, validar, y securizar formularios, quede reducida a un &ldquo;simple&rdquo; array.</p><p>Este Form API dispone de unos tipos, que yo denominaría primitivos, y no porque&rsquo;estén anticuados, si no por que a partir de ellos se pueden crear construcciones más complejas, como hace el módulo <a href=https://api.drupal.org/api/drupal/modules%21field%21field.module/group/field/7.x>Field</a>, más concretamente su submódulo <a href=https://api.drupal.org/api/drupal/modules!field_ui!field_ui.module/7.x>Field UI</a>, que como ya sabréis es el que nos facilita la creación de los distintos tipos de campos, por ejemplo en la creación de contenido. </p><p>Doy por hecho que conoces Drupal y con ello lo potente que es a la hora de tener distintos tipos de campos para crear contenido, no los campos convencionales de una base de datos, si no campos como, un mapa de <a href=https://www.drupal.org/project/geolocation>localización</a>, <a href=https://www.drupal.org/project/imagefield_crop>imágenes que pueden ser recortadas</a>, un <a href=https://www.drupal.org/project/addressfield>campo de dirección postal</a> que cambia según el país seleccionado, etc&mldr;.</p><p>Estos campos (<em>fields</em>) disponen de <em>widgets</em> para introducir los valores, por ejemplo el campo localización en lugar de pedir, las coordenadas de forma numérica (algo generalmente complicado para un usuario), lo hace mostrando un mapa sobre el que podemos hacer búsquedas y pinchar en la localización que deseemos, esto internamente sigue siendo un par de números, pero la forma de introducirlos es lo que marca la diferencia.</p><p>Estos <em>widgets</em> que implementan los módulos (ya sea el propio <em>Fields</em> o los de terceros) lo que hacen en realidad es usar como base la potencia del **Form API. ¿**Y si pudiésemos nosotros reutilizar los widgets que se están usando, por ejemplo en un formulario de creación de un tipo de contenido (nodo)?. Pues podemos y es relativamente sencillo.</p><pre tabindex=0><code>function mymodule_register_form($form, &amp;$form_state) {
    $form[&#39;organization_name&#39;] = array(
      &#39;#type&#39; =&gt; &#39;textfield&#39;,
      &#39;#title&#39; =&gt; &#39;Name of the organization&#39;,
      &#39;#required&#39; =&gt; true
    );

    $tmpnode = new stdClass();
    $tmpnode-&gt;type = &#39;organization&#39;;
    field_attach_form(&#39;node&#39;, $tmpnode, $form, $form_state, LANGUAGE_NONE, array(
      &#39;field_name&#39; =&gt; &#39;field_full_address&#39;,
    ));

    return $form;

}
</code></pre><p>En el ejemplo, tenemos un formulario estándar con un campo <em>organization_name</em> que es un simple <em>textfield</em> del Form API, pero además, necesitamos recuperar una dirección, para lo cual podríamos crear varios campos y programar la intereactividad, buscar la lista de países, con sus provincias y como se estructura una dirección en cada uno, etc. Podríamos hacer, si, pero ya está hecho por el módulo <a href=http://www.drupal.org/project/addressfield>addressfield</a>, que ademas estamos usando en un tipo de contenido llamado &ldquo;Organización&rdquo; con el nombre de campo _field_full_address _y lo único que tenemos que hacer es reusar el widget de dicho campo.</p><pre tabindex=0><code>$tmpnode = new stdClass();
$tmpnode-&gt;type = &#39;organization&#39;;
field_attach_form(&#39;node&#39;, $tmpnode, $form, $form_state, LANGUAGE_NONE, array(
  &#39;field_name&#39; =&gt; &#39;field_full_address&#39;,
));
</code></pre><p>Con las lineas encima de este párrafo, lo que estamos haciendo es crear un objeto estándar con la única propiedad <em>type</em> que indica el tipo de nodo donde esta el campo del que vamos a &ldquo;copiar&rdquo; el widget. E invocando a <a href=https://api.drupal.org/api/drupal/modules%21field%21field.attach.inc/function/field_attach_form/7.x>field_attach_form</a> lo que hacemos es &ldquo;inyectar&rdquo; en un formulario todos los campos de otro (en este caso todos los campos del formulario que se mostraría al crear o editar un nodo de tipo <em>organization</em>, pero como solo queremos usar un campo concreto, el último parámetro es un array de opciones donde especificamos que solo queremos usar el campo llamado _field_full_address ¡_y listo!</p><p>Ya podemos usar el widget en nuestro formulario.</p><p>El caso que ha motivado esta entrada de blog, es algo que puede ser relativamente habitual, en mi caso, en el formulario de registro de usuario de Drupal, necesitaba pedir una serie de campos adicionales (como la dirección) que no iban a ser almacenados en el usuario, sino que crearían un nodo en nombre del usuario con los datos adicionales pedidos en el formulario de registro, de esta forma el usuario solo tiene que completar un formulario mejorando su experiencia en el uso de la web.</p></div></div><aside class=post__nav-wrapper><div class=wrapper-1200><div class="post-nav post-nav--prev"><a class=post-nav__link href="https://sergiocarracedo.es/2017/06/13/por-que-el-directorio-home-en-linux-se-representa-con-tilde/?ref=footer"><div class=post-nav__cover><img alt=.NextPage.Title src=/2017/06/13/por-que-el-directorio-home-en-linux-se-representa-con-tilde/pexels-photo-698808_hub6b802a2aad7a8fe5cb4fcb2aa05c9d4_80802_200x120_fill_q75_box_center.jpeg></div><div class=post-nav__title>¿Por qué el directorio home en linux se representa...</div></a></div><div class=blog-link><a class=btn href=https://sergiocarracedo.es/blog>All Blog posts</a></div><div class="post-nav post-nav--next"><a class=post-nav__link href="https://sergiocarracedo.es/2017/05/18/recibir-notificaciones-de-acceso-ssh-desde-una-ip-desconocida/?ref=footer"><div class=post-nav__cover><img alt=.PrevPage.Title class=post-nav__cover src=/2017/05/18/recibir-notificaciones-de-acceso-ssh-desde-una-ip-desconocida/pexels-photo-397225_hu0c9fa6fed52591c92b49d5956ade45e4_1034396_200x120_fill_q75_box_center.jpeg></div><div class=post-nav__title>Recibir notificaciones de acceso SSH desde una IP...</div></a></div></div></aside><aside class=post__search-wrapper><div class=wrapper-1200>Search in this blog:<form class=search-form action=https://sergiocarracedo.es/search method=get><label hidden for=search-input>Search</label>
<input type=text id=search-input name=query placeholder=Search class=search-form__input>
<button class=search-form__button>
<i class="fas fa-search"></i></button></form></div></aside><aside class=post__comments><div class=wrapper-1200><div id=disqus_thread>To show the comments is mandatory accept cookie policy.</div></div></aside></article></div><footer class=web-footer><div class=wrapper-1200><div class=web-footer__left><div class=me><div class=me__avatar><img alt="Sergio Carracedo" src=/i/sergiocarracedo_hu6caa808ff324b89bfea4b9d7d1c850ee_80590_170x170_fit_q75_box.jpg></div><div class=me__titles><h1>Sergio Carracedo</h1><h2>Senior Fullstack developer.</h2><h3>Always learning, cats, good conversations and small details lover.</h3></div></div></div><div class=web-footer__right><nav role=main class=menu><ul><li class=menu__item><a href=https://sergiocarracedo.es/>Home</a></li><li class=menu__item><a href=https://sergiocarracedo.es/blog>Blog</a></li></ul></nav><div class=social><a class=social__link href=http://www.linkedin.com/in/sergiocarracedo target=_blank title=LinkedIn style=animation-delay:2s><i class="fab fa-linkedin"></i>
</a><a class=social__link href=mailto:hi+blog@sergiocarracedo.es target=_blank title=Email style=animation-delay:1.9333333333333333s><i class="fas fa-envelope"></i>
</a><a class=social__link href=https://github.com/sergiocarracedo target=_blank title=GitHub style=animation-delay:1.8666666666666667s><i class="fab fa-github"></i>
</a><a class=social__link href=https://www.drupal.org/u/sergiocarracedo target=_blank title=Drupal style=animation-delay:1.8s><i class="fab fa-drupal"></i>
</a><a class=social__link href=https://www.twitter.com/sergiocarracedo target=_blank title=Twitter style=animation-delay:1.7333333333333334s><i class="fab fa-twitter"></i>
</a><a class=social__link href=http://www.last.fm/user/gasman40 target=_blank title=Last.fm style=animation-delay:1.6666666666666667s><i class="fab fa-lastfm"></i>
</a><a class=social__link href=http://sergiocarracedo.tumblr.com/ target=_blank title=Tumblr style=animation-delay:1.6s><i class="fab fa-tumblr"></i></a></div></div></div></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-87X78TXEGE"></script><script>function runGA(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-87X78TXEGE")}</script><script>function runDisqus(){(function(){var e=document,t=e.createElement("script");t.src="https://sergiocarracedo.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()}</script><script src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js></script><script>window.addEventListener("load",function(){window.cookieconsent.initialise({palette:{popup:{background:"#004262",text:"#fff"},button:{background:"#8ec760",text:"#ffffff"}},type:"opt-out",content:{message:"Este sitio usa cookies propias y de terceros para mejorar la experiencia de usuario y esas cosas.",allow:"Ok, continua",deny:"Nada de cookies",link:"Saber más",href:"https://sergiocarracedo.es/cookies"},onStatusChange:function(e){e=="allow"&&runCookiesAllowed()},onInitialise:function(e){e=="allow"&&runCookiesAllowed()}})})</script><script>addEventListener("scroll",e=>{let t=document.getElementsByTagName("body")[0];t&&window.scrollY>10?t.classList.add("not-in-top"):t.classList.remove("not-in-top")});function runCookiesAllowed(){runGA(),runDisqus()}</script><script integrity="sha256-iiQa3rTjie3Ydsr4WEu2+aLDTaxKKVR3ZTwTYrRUjXs=" src=https://sergiocarracedo.es/js/theme.8a241adeb4e389edd876caf8584bb6f9a2c34dac4a295477653c1362b4548d7b.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script integrity="sha256-LVPRt2Ca+MpOY1KztdII4jRv+U0kJBcBZEvwhZr2a4Y=" src=https://sergiocarracedo.es/js/search.2d53d1b7609af8ca4e6352b3b5d208e2346ff94d24241701644bf0859af66b86.js></script></body></html>