
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sergio Carracedo - Usar un 'field widget' en un formulario convencional en Drupal 7</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="keywords" content="Sergio Carracedo,"> 
    <meta name="description" content="Sergio Carracedo personal Blog,El Form API de Drupal es muy potente, para mí es algo, que cuando programo sobre otros CMS o framew,"> 
    <meta name="author" content="Sergio Carracedo"> 
    <link rel="alternative" href="atom.xml" title="Sergio Carracedo" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="/css/sergiocarracedo.css">

    <meta name="description" content="El Form API de Drupal es muy potente, para mí es algo, que cuando programo sobre otros CMS o frameworks echo mucho en falta, por que Drupal ha conseguido que la laboriosa tarea de crear, validar, y se">
<meta property="og:type" content="article">
<meta property="og:title" content="Usar un &#39;field widget&#39; en un formulario convencional en Drupal 7">
<meta property="og:url" content="https://sergiocarracedo.es/2017/06/08/usar-un-field-widget-en-un-formulario-convencional-en-drupal-7/index.html">
<meta property="og:site_name" content="Sergio Carracedo">
<meta property="og:description" content="El Form API de Drupal es muy potente, para mí es algo, que cuando programo sobre otros CMS o frameworks echo mucho en falta, por que Drupal ha conseguido que la laboriosa tarea de crear, validar, y se">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://sergiocarracedo.es/images/pexels-photo-268466_0.jpeg">
<meta property="article:published_time" content="2017-06-08T00:00:00.000Z">
<meta property="article:modified_time" content="2021-04-01T09:34:35.380Z">
<meta property="article:author" content="Sergio Carracedo">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://sergiocarracedo.es/images/pexels-photo-268466_0.jpeg">

    <script async src='https://www.google-analytics.com/analytics.js'></script>

    <script>
      function runGA() {
        window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
        ga('create', 'UA-133459072-1', 'auto');
        ga('send', 'pageview');
      }

      function runDisqus() {
        /*var disqus_config = function () {
          this.page.url = 'https://sergiocarracedo.es/';
          this.page.identifier = 'sergiocarracedo';
        }*/
        (function() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://sergiocarracedo.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      }

      function runCookiesAllowed() {
        runGA();
        runDisqus();
      }
    </script>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
    <div id="single">
    <div id="top">
  <div class="bar" style="width: 0;"></div>
  <div class="container-fluid">
    <div class="grid-row">
      <div class="col-xs-12 col-sm-3">
        <a class="back-to-home" href="/">
          <img src="/img/sergiocarracedo.jpg" alt="Sergio Carracedo" class="image-logo"/>
          <h4>
            Sergio Carracedo
          </h4>
        </a>
      </div>
      <div class="hidden-xs col-sm-6">
        <h3 class="subtitle">Usar un 'field widget' en un formulario convencional en Drupal 7</h3>
      </div>
    </div>
  </div>
  <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article container-fluid-1200">
  <div class="grid-row">
    <div class="main col-xs-12">
      <h1 class="title">
        Usar un 'field widget' en un formulario convencional en Drupal 7
      </h1>
      <div class="stuff">
        <span>June 08, 2017</span>
      </div>

      
      <div class="article-image">
        <img src="/images/header_pexels-photo-268466_0.jpeg" width="1200" height="400">
      </div>
      
      <div class="content markdown">
        <p>El <a target="_blank" rel="noopener" href="https://api.drupal.org/api/drupal/developer%21topics%21forms_api_reference.html/7.x">Form API</a> de Drupal es muy potente, para mí es algo, que cuando programo sobre otros <em>CMS</em> o <em>frameworks</em> echo mucho en falta, por que Drupal ha conseguido que la laboriosa tarea de crear, validar, y securizar formularios, quede reducida a un “simple” array.</p>
<p>Este Form API dispone de unos tipos, que yo denominaría primitivos, y no porque’estén anticuados, si no por que a partir de ellos se pueden crear construcciones más complejas, como hace el módulo <a target="_blank" rel="noopener" href="https://api.drupal.org/api/drupal/modules%21field%21field.module/group/field/7.x">Field</a>, más concretamente su submódulo <a target="_blank" rel="noopener" href="https://api.drupal.org/api/drupal/modules!field_ui!field_ui.module/7.x">Field UI</a>, que como ya sabréis es el que nos facilita la creación de los distintos tipos de campos, por ejemplo en la creación de contenido. </p>
<p>Doy por hecho que conoces Drupal y con ello lo potente que es a la hora de tener distintos tipos de campos para crear contenido, no los campos convencionales de una base de datos, si no campos como, un mapa de <a target="_blank" rel="noopener" href="https://www.drupal.org/project/geolocation">localización</a>, <a target="_blank" rel="noopener" href="https://www.drupal.org/project/imagefield_crop">imágenes que pueden ser recortadas</a>, un <a target="_blank" rel="noopener" href="https://www.drupal.org/project/addressfield">campo de dirección postal</a> que cambia según el país seleccionado, etc….</p>
<p>Estos campos (<em>fields</em>) disponen de <em>widgets</em> para introducir los valores, por ejemplo el campo localización en lugar de pedir, las coordenadas de forma numérica (algo generalmente complicado para un usuario), lo hace mostrando un mapa sobre el que podemos hacer búsquedas y pinchar en la localización que deseemos, esto internamente sigue siendo un par de números, pero la forma de introducirlos es lo que marca la diferencia.</p>
<p>Estos <em>widgets</em> que implementan los módulos (ya sea el propio <em>Fields</em> o los de terceros) lo que hacen en realidad es usar como base la potencia del <strong>Form API. ¿</strong>Y si pudiésemos nosotros reutilizar los widgets que se están usando, por ejemplo en un formulario de creación de un tipo de contenido (nodo)?. Pues podemos y es relativamente sencillo.</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function mymodule_register_form($form, &amp;$form_state) {</span><br><span class="line">    $form['organization_name'] = array(</span><br><span class="line">&nbsp; &nbsp; &nbsp; '#type' =&gt; 'textfield',</span><br><span class="line">&nbsp; &nbsp; &nbsp; '#title' =&gt; 'Name of the organization',</span><br><span class="line">&nbsp; &nbsp; &nbsp; '#required' =&gt; true</span><br><span class="line">&nbsp; &nbsp; );</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; $tmpnode = new stdClass();</span><br><span class="line">&nbsp; &nbsp; $tmpnode-&gt;type = 'organization';</span><br><span class="line">    field_attach_form('node', $tmpnode, $form, $form_state, LANGUAGE_NONE, array(</span><br><span class="line">      'field_name' =&gt; 'field_full_address',</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; return $form;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>En el ejemplo, tenemos un formulario estándar con un campo <em>organization_name</em> que es un simple <em>textfield</em> del Form API, pero además, necesitamos recuperar una dirección, para lo cual podríamos crear varios campos y programar la intereactividad, buscar la lista de países, con sus provincias y como se estructura una dirección en cada uno, etc. Podríamos hacer, si, pero ya está hecho por el módulo <a target="_blank" rel="noopener" href="http://www.drupal.org/project/addressfield">addressfield</a>, que ademas estamos usando en un tipo de contenido llamado “Organización” con el nombre de campo _field_full_address _y lo único que tenemos que hacer es reusar el widget de dicho campo.</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$tmpnode = new stdClass();</span><br><span class="line">$tmpnode-&gt;type = 'organization';</span><br><span class="line">field_attach_form('node', $tmpnode, $form, $form_state, LANGUAGE_NONE, array(</span><br><span class="line">  'field_name' =&gt; 'field_full_address',</span><br><span class="line">));</span><br></pre></td></tr></tbody></table></figure>

<p>Con las lineas encima de este párrafo, lo que estamos haciendo es crear un objeto estándar con la única propiedad <em>type</em> que indica el tipo de nodo donde esta el campo del que vamos a “copiar” el widget. E invocando a <a target="_blank" rel="noopener" href="https://api.drupal.org/api/drupal/modules%21field%21field.attach.inc/function/field_attach_form/7.x">field_attach_form</a> lo que hacemos es “inyectar” en un formulario todos los campos de otro (en este caso todos los campos del formulario que se mostraría al crear o editar un nodo de tipo <em>organization</em>, pero como solo queremos usar un campo concreto, el último parámetro es un array de opciones donde especificamos que solo queremos usar el campo llamado _field_full_address ¡_y listo!</p>
<p>Ya podemos usar el widget en nuestro formulario.</p>
<p>El caso que ha motivado esta entrada de blog, es algo que puede ser relativamente habitual, en mi caso, en el formulario de registro de usuario de Drupal, necesitaba pedir una serie de campos adicionales (como la dirección) que no iban a ser almacenados en el usuario, sino que crearían un nodo en nombre del usuario con los datos adicionales pedidos en el formulario de registro, de esta forma el usuario solo tiene que completar un formulario mejorando su experiencia en el uso de la web.</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      </div>
    </div>
  </div>
</div>

<div class="post-nav">
  <div class="container-fluid-1200">
    <div class="grid-row">
      <div class="next col-xs-6">
        
          <div class="nav-previous">
            <a href="https://sergiocarracedo.es//2017/06/13/por-que-el-directorio-home-en-linux-se-representa-con-tilde/" rel="prev" class="nav-cover">
              <img src="/images/teaser_pexels-photo-698808.jpeg">
            </a>

            <a href="https://sergiocarracedo.es//2017/06/13/por-que-el-directorio-home-en-linux-se-representa-con-tilde/" rel="prev" class="nav-text">
              <i class="fa fa-arrow-left"></i> ¿Por qué el directorio home en linux se representa con ~ (tilde)?
            </a>
          </div>
        
      </div>
      <div class="prev col-xs-6">
        
          <div class="nav-next">
            <a href="https://sergiocarracedo.es//2017/05/18/recibir-notificaciones-de-acceso-ssh-desde-una-ip-desconocida/" rel="next" class="nav-cover">
              <img src="/images/teaser_pexels-photo-397225.jpeg">
            </a>

            <a href="https://sergiocarracedo.es//2017/05/18/recibir-notificaciones-de-acceso-ssh-desde-una-ip-desconocida/" rel="next" class="nav-text">
              Recibir notificaciones de acceso SSH desde una IP desconocida <i class="fa fa-arrow-right"></i>
            </a>
          </div>
        
      </div>
    </div>
  </div>
</div>

<div class="post-comments container-fluid-1200">
    <div id="disqus_thread">To show the comments is mandatory accept cookie policy.</div>
</div>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<div id="post-aboutme">
  <div class="me container-fluid">
    <div class="grid-row">
      <div class="col-xs-12 mb-5">
        <div class="social">
  <a href="mailto:info@sergiocarracedo.es" class="social-link" title="info@sergiocarracedo.es">
    <i class="fas fa-envelope"></i>
  </a>
  <a href="https://github.com/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-github"></i>
  </a>
  <a href="https://www.drupal.org/u/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-drupal"></i>
  </a>

  <a href="http://www.linkedin.com/in/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-linkedin"></i>
  </a>
  <a href="https://www.twitter.com/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-twitter"></i>
  </a>
  <a href="http://www.last.fm/user/gasman40" class="social-link" target="_blank">
    <i class="fab fa-lastfm"></i>
  </a>
  <a href="http://sergiocarracedo.tumblr.com/" class="social-link" target="_blank">
    <i class="fab fa-tumblr"></i>
  </a>
</div>

      </div>
    </div>
  </div>

  <div class="claim container-fluid-1440">
    <div class="grid-row">
      <div class="col-xs-12">
        <h3>Front-end and back-end developer.<br />#formula1, good conversations and small details lover.</h3>
      </div>
    </div>
  </div>

  <div class="container-fluid-1440">
    <div class="grid-row">
      <div class="col-xs-12">
        <a href="/" class="back">
          Home
        </a>
      </div>
    </div>
  </div>

</div>


    </div>


</div>

</body>
<script src="https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<script src="/js/jquery.min.js"></script>
<script src="/js/sergiocarracedo.js"></script>


<link href="https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css" rel="stylesheet">
<link href="https://cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css" rel="stylesheet">

<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
    <script>
      window.addEventListener("load", function(){
        window.cookieconsent.initialise({
          "palette": {
            "popup": {
              "background": "#004262",
              "text": "#fff"
            },
            "button": {
              "background": "#8ec760",
              "text": "#ffffff"
            }
          },
          "type": "opt-out",
          "content": {
            "message": "Este sitio usa cookies propias y de terceros para mejorar la experiencia de usuario y esas cosas.",
            "allow": "Ok, continua",
            "deny": "Nada de cookies",
            "link": "Saber más",
            "href": "https://sergiocarracedo.es/cookies.html",
          },
          "onStatusChange": function(status, chosenBefore) {
            if (status == 'allow') {
               runCookiesAllowed()
            }
          },
          "onInitialise" : function(status) {
            if (status == 'allow') {
               runCookiesAllowed()
            }
          }
        })
      });
    </script>


</html>
