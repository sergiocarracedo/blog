
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sergio Carracedo - Creating custom events in JS</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="keywords" content="Sergio Carracedo,"> 
    <meta name="description" content="Sergio Carracedo personal Blog,When you try to encapsulate features but need to interact with async events or events generated by ,"> 
    <meta name="author" content="Sergio Carracedo"> 
    <link rel="alternative" href="atom.xml" title="Sergio Carracedo" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="/css/sergiocarracedo.css">

    <meta name="description" content="When you try to encapsulate features but need to interact with async events or events generated by user interaction, one of the easiest ways to achieve that is using event and event handlers (often ca">
<meta property="og:type" content="article">
<meta property="og:title" content="Creating custom events in JS">
<meta property="og:url" content="https://sergiocarracedo.es/creating-custom-events-in-js/index.html">
<meta property="og:site_name" content="Sergio Carracedo">
<meta property="og:description" content="When you try to encapsulate features but need to interact with async events or events generated by user interaction, one of the easiest ways to achieve that is using event and event handlers (often ca">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://sergiocarracedo.es/images/2021/custom-events-1314544.jpg">
<meta property="article:published_time" content="2021-10-18T00:00:00.000Z">
<meta property="article:modified_time" content="2022-09-08T07:23:28.009Z">
<meta property="article:author" content="Sergio Carracedo">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://sergiocarracedo.es/images/2021/custom-events-1314544.jpg">

    <script async src='https://www.google-analytics.com/analytics.js'></script>

    <script>
      function runGA() {
        window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
        ga('create', 'UA-133459072-1', 'auto');
        ga('send', 'pageview');
      }

      function runDisqus() {
        /*var disqus_config = function () {
          this.page.url = 'https://sergiocarracedo.es/';
          this.page.identifier = 'sergiocarracedo';
        }*/
        (function() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://sergiocarracedo.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      }

      function runCookiesAllowed() {
        runGA();
        runDisqus();
      }
    </script>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<meta name="generator" content="Hexo 6.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <div id="single">
    <div id="top">
  <div class="bar" style="width: 0;"></div>
  <div class="container-fluid">
    <div class="grid-row">
      <div class="col-xs-12 col-sm-3">
        <a class="back-to-home" href="/">
          <img src="/img/sergiocarracedo.jpg" alt="Sergio Carracedo" class="image-logo"/>
          <h4>
            Sergio Carracedo
          </h4>
        </a>
      </div>
      <div class="hidden-xs hidden-lxs col-sm-6">
        <h3 class="subtitle">Creating custom events in JS</h3>
      </div>
    </div>
  </div>
  <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article container-fluid-1200">
  <div class="grid-row">
    <div class="main col-xs-12">
      <h1 class="title">
        Creating custom events in JS
      </h1>
      <div class="stuff">
        <span>October 18, 2021</span>
      </div>

      
      <div class="article-image">
        <img src="/images/2021/header_custom-events-1314544.jpg" width="1200" height="400">
      </div>
      
      <div class="content markdown">
        <p>When you try to encapsulate features but need to interact with async events or events generated by user interaction, one of the easiest ways to achieve that is using event and event handlers (often called callbacks).</p>
<p>Imagine you have a UI component to render a TO-DO list with a button to create a TO-DO item through a form. This component is self-encapsulated, you only need to put the component in your app, and the component itself renders the list, the button, the form, do the request to API, etc.</p>
<p>You want to do some action after the TO-DO creation, for example, display a toast or an alert with some message.</p>
<p>You can alter the component and add that behavior into the component, but this reduces the reusability of the component because in other parts of your app (or in other app) this behaviour makes no sense.</p>
<h2 id="Events-and-callbacks-to-the-rescue"><a href="#Events-and-callbacks-to-the-rescue" class="headerlink" title="Events and callbacks to the rescue"></a>Events and callbacks to the rescue</h2><p>A callback for an event is a piece of code that runs when the event is dispatched. We are using that a lot in JS, for example when we want to do something after the user interacts with an element.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.addEventListener(<span class="string">'click'</span>, <span class="function">() =&gt;</span> { alert(<span class="string">'hello'</span>) }, ...)</span><br></pre></td></tr></tbody></table></figure>

<p>With the line above, the code (listener or callback) will run when the user clicks the element</p>
<p>Browserâ€™s API provides a lot of events we can <em>handle</em>, but we want to do it by ourselves, and itâ€™s very easy:</p>
<p>First, we need to expose outside the component I mentioned before a method to set the callback for example <code>setToDoCreateEventHandler</code></p>
<blockquote>
<p>To simplify the example we will create a simple event dispatch system that only allows one handler</p>
</blockquote>
<p>This function will receive as param a function will be called when the event dispatches</p>
<p>For example:</p>
<figure class="highlight ts"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main app</span></span><br><span class="line"><span class="keyword">import</span> myTodoComponent <span class="keyword">from</span> <span class="string">'myTodoComponent'</span></span><br><span class="line">myTodoComponent.setToDoCreateEventHandler(<span class="function">() =&gt;</span> alert(<span class="string">'TO-DO created'</span>))</span><br></pre></td></tr></tbody></table></figure>

<p>The implementation of the method in the component could be something like:</p>
<figure class="highlight ts"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Component</span></span><br><span class="line"><span class="keyword">let</span> toDoCreateEventHandler: <span class="built_in">Function</span> = <span class="function">() =&gt;</span> {}</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setToDoCreateEventHandler</span> (<span class="params">handler: <span class="built_in">Function</span></span>): <span class="title">void</span> </span>{</span><br><span class="line">  toDoCreateEventHandler = handler</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>We have the variable <code>toDoCreateEventHandler</code> where to store the handler, by default I set an empty function <code>() =&gt; {}</code> that doesnâ€™t do anything just to avoid manage <code>null</code> values (but you can allow <code>null</code> or <code>undefined</code> as a handler and check it before dispatch it)</li>
<li>Our exposed <code>setToDoCreateEventHandler</code> function is in charge of set the handler to the variable</li>
</ul>
<p>Ok, now we can store the handler, but we need to dispatch it, to do it we only need to execute the handler in the part of the component where the TODO creation is complete, imagine is after sending the values to API and get an OK</p>
<figure class="highlight ts"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Component</span></span><br><span class="line">...</span><br><span class="line">axios(...).then(<span class="function">() =&gt;</span> {</span><br><span class="line">  ... <span class="comment">// Do other things</span></span><br><span class="line">  toDoCreateEventHandler()</span><br><span class="line">})</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p><em>Thatâ€™s all</em> <span class="github-emoji"><span>ðŸ˜‚</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f602.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>, after saving the TODO doing a call to the API using <em>axios</em> (in this example) we call the handler stored in the variable, and our code outside the component will be executed.</p>
<p>As you can see itâ€™s very easy to create custom components.</p>
<p>We can improve our event handler allowing to add more than one listener/handler, for example</p>
<figure class="highlight ts"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Component</span></span><br><span class="line"><span class="keyword">let</span> toDoCreateEventHandlers: <span class="built_in">Function</span>[] = []</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addToDoCreateEventHandler</span> (<span class="params">handler: <span class="built_in">Function</span></span>): <span class="title">void</span> </span>{</span><br><span class="line">  toDoCreateEventHandlers.push(handler)</span><br><span class="line">}</span><br><span class="line">...</span><br><span class="line">axios(...).then(<span class="function">() =&gt;</span> {</span><br><span class="line">  ... <span class="comment">// Do other things</span></span><br><span class="line">  toDoCreateEventHandlers.forEach(<span class="function"><span class="params">handler</span> =&gt;</span> handler())</span><br><span class="line">})</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>We also need to define a method to remove a handler, but I will let you do it.</p>
<p>You could think we can achieve this using <em>Promises</em>, and you are partially right, but promises only <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/20328073/is-it-safe-to-resolve-a-promise-multiple-times">can be resolved once</a></p>
<p>Event dispatch / handler has the advantage you can attach to the event at any moment (and wait for the new dispatches) and are widely used in the standard JS libraries.</p>

      </div>
    </div>
  </div>
</div>

<div class="post-nav">
  <div class="container-fluid-1200">
    <div class="grid-row">
      <div class="next col-xs-6">
        
          <div class="nav-previous">
            <a href="https://sergiocarracedo.es//database-migrations-in-golang/" rel="prev" class="nav-cover">
              <img src="/images/2021/teaser_go-migrate-pexels-james-wheeler-1598075.jpg">
            </a>

            <a href="https://sergiocarracedo.es//database-migrations-in-golang/" rel="prev" class="nav-text">
              <i class="fa fa-arrow-left"></i> Database migrations in Golang.
            </a>
          </div>
        
      </div>
      <div class="prev col-xs-6">
        
          <div class="nav-next">
            <a href="https://sergiocarracedo.es//how-to-create-a-table-with-a-fixed-header/" rel="next" class="nav-cover">
              <img src="/images/2021/teaser_table-fixed-header.jpg">
            </a>

            <a href="https://sergiocarracedo.es//how-to-create-a-table-with-a-fixed-header/" rel="next" class="nav-text">
              How to create a table with a fixed header <i class="fa fa-arrow-right"></i>
            </a>
          </div>
        
      </div>
    </div>
  </div>
</div>

<div class="post-comments container-fluid-1200">
    <div id="disqus_thread">To show the comments is mandatory accept cookie policy.</div>
</div>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<div id="post-aboutme">
  <div class="me container-fluid">
    <div class="grid-row">
      <div class="col-xs-12 mb-5">
        <div class="social">
  <a href="http://www.linkedin.com/in/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-linkedin"></i>
  </a>
  <a href="mailto:hi+blog@sergiocarracedo.es" class="social-link" title="hi+blog@sergiocarracedo.es">
    <i class="fas fa-envelope"></i>
  </a>

  <a href="https://github.com/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-github"></i>
  </a>
  <a href="https://www.drupal.org/u/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-drupal"></i>
  </a>


  <a href="https://www.twitter.com/sergiocarracedo" class="social-link" target="_blank">
    <i class="fab fa-twitter"></i>
  </a>
  <a href="http://www.last.fm/user/gasman40" class="social-link" target="_blank">
    <i class="fab fa-lastfm"></i>
  </a>
  <a href="http://sergiocarracedo.tumblr.com/" class="social-link" target="_blank">
    <i class="fab fa-tumblr"></i>
  </a>
</div>

      </div>
    </div>
  </div>

  <div class="claim container-fluid-1440">
    <div class="grid-row">
      <div class="col-xs-12">
        <h3>Front-end and back-end developer.<br />#formula1, good conversations and small details lover.</h3>
      </div>
    </div>
  </div>

  <div class="container-fluid-1440">
    <div class="grid-row">
      <div class="col-xs-12">
        <a href="/" class="back">
          Home
        </a>
      </div>
    </div>
  </div>

</div>


    </div>


</div>

</body>
<script src="https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<script src="/js/jquery.min.js"></script>
<script src="/js/sergiocarracedo.js"></script>


<link href="https://cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css" rel="stylesheet">
<link href="https://cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css" rel="stylesheet">

<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
    <script>
      window.addEventListener("load", function(){
        window.cookieconsent.initialise({
          "palette": {
            "popup": {
              "background": "#004262",
              "text": "#fff"
            },
            "button": {
              "background": "#8ec760",
              "text": "#ffffff"
            }
          },
          "type": "opt-out",
          "content": {
            "message": "Este sitio usa cookies propias y de terceros para mejorar la experiencia de usuario y esas cosas.",
            "allow": "Ok, continua",
            "deny": "Nada de cookies",
            "link": "Saber mÃ¡s",
            "href": "https://sergiocarracedo.es/cookies.html",
          },
          "onStatusChange": function(status, chosenBefore) {
            if (status == 'allow') {
               runCookiesAllowed()
            }
          },
          "onInitialise" : function(status) {
            if (status == 'allow') {
               runCookiesAllowed()
            }
          }
        })
      });
    </script>


</html>
