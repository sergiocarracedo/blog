<!doctype html><html><head><meta charset=UTF-8><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><meta content="width=device-width,minimum-scale=1" name=viewport><title>Sergio Carracedo | Axios interceptors to validate allowed headers</title>
<meta content="yes" name=apple-mobile-web-app-capable><meta content="black-translucent" name=apple-mobile-web-app-status-bar-style><meta content="Sergio Carracedo's personal page and blog" name=description><meta content="Sergio Carracedo" name=author><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta property="og:title" content="Axios interceptors to validate allowed headers"><meta property="og:description" content="Today I want to share a small tip working with CORS and Axios.
It&rsquo;s very typical in the backend to only allow certain headers, even more so when it defines the CORS-related Access-Control-Request-Headers header used in response to a preflight request. In those cases, if the frontend
make a request with an unexpected header the request will be rejected.
This kind of issue mostly happens in the production environments because the browser ignores CORS headers when it
fetches data from localhost. That is a problem as nobody will probably detect an issue sending unexpected headers
before deploying the code to production."><meta property="og:type" content="article"><meta property="og:url" content="https://sergiocarracedo.es/axios-interceptors-validate-headers/"><meta property="og:image" content="https://sergiocarracedo.es/axios-interceptors-validate-headers/nathan-dumlao-eksqjXTLpak-unsplash_hu2332664082599071188.jpg"><meta name=twitter:image content="https://sergiocarracedo.es/axios-interceptors-validate-headers/nathan-dumlao-eksqjXTLpak-unsplash_hu2332664082599071188.jpg"></meta><meta property="article:section" content="blog">
<meta property="article:published_time" content="2024-07-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-01T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"></meta>
<link rel=canonical href=https://sergiocarracedo.es/axios-interceptors-validate-headers/><link href=https://sergiocarracedo.es/scss/main.caf226497f203f2edd2ff9a1f6b61375ba7080654d3a72e669d159aa8804cecf.css integrity="sha256-yvImSX8gPy7dL/mh9rYTdbpwgGVNOnLmadFZqogEzs8=" rel=stylesheet><link href=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css rel=stylesheet type=text/css></head><body><header class="web-header background-paper-secondary"><h2><a class=back-to-home href=/ title="Back to home"><i class="fas fa-home"></i><div class=back-to-home__content><span class=back-to-home__action>Back to home</span><div class=back-to-home__title><img alt="Sergio Carracedo" class=avatar src=/i/sergiocarracedo_hu15161314200389136556.jpg><h4>Sergio Carracedo</h4></div></div></a></h2><div class=web-header__page-title><span>Axios interceptors to validate allowed headers</span></div><div class=theme-switch><i class="theme-switch__theme fas fa-sun" id=theme-switch-light title="Switch to light theme"></i>
<i class="theme-switch__theme fas fa-moon" id=theme-switch-dark title="Switch to dark theme"></i></div></header><div class=main-content><article class="post post--single"><div class="post__main wrapper-1200"><aside class=post__metadata><time class=post__date datetime=2024-07-01><i class="far fa-calendar-alt"></i> Jul 1, 2024
</time><a href=https://sergiocarracedo.es/tags/axios class=post__tag><span>axios</span>
</a><a href=https://sergiocarracedo.es/tags/request class=post__tag><span>request</span>
</a><a href=https://sergiocarracedo.es/tags/validation class=post__tag><span>validation</span>
</a><span class=post__reading-time><i class="far fa-clock"></i> 2 minutes read</span></aside><header class=post__header><h1 class=post__title>Axios interceptors to validate allowed headers</h1></header><figure class=post__cover><img alt="Axios interceptors to validate allowed headers" height=400 src=/axios-interceptors-validate-headers/nathan-dumlao-eksqjXTLpak-unsplash_hu12502061591923924482.jpg width=1200></figure><div class=post__content><p>Today I want to share a small tip working with CORS and Axios.</p><p>It&rsquo;s very typical in the backend to only allow certain headers, even more so when it defines the CORS-related <code>Access-Control-Request-Headers</code> header used in response to a preflight request. In those cases, if the frontend
make a request with an <em>unexpected</em> header the request will be rejected.</p><p>This kind of issue mostly happens in the production environments because the browser ignores CORS headers when it
fetches data from <code>localhost</code>. That is a problem as nobody will probably detect an issue sending unexpected headers
before deploying the code to production.</p><h2 id=axios-interceptors>Axios interceptors</h2><p><a href=https://axios-http.com/>Axios</a> is a widely used library to manage HTTP requests that have an interesting feature: <strong>the
interceptors</strong> are like middlewares where you can execute code before the request (<em>request interceptors</em>) and/or
after getting the response (<em>response interceptors</em>)</p><p>We will focus on the request interceptors, which are executed before the request to the server is made, this is
the perfect place to put our code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>InternalAxiosRequestConfig</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;axios&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>allowedCorsHeaders</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Authorization&#39;</span>,<span style=color:#e6db74>&#39;Origin&#39;</span>,<span style=color:#e6db74>&#39;X-Requested-With&#39;</span>, <span style=color:#e6db74>&#39;Content-Type&#39;</span>,<span style=color:#e6db74>&#39;Accept&#39;</span>].<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>header</span>) <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>header</span>.<span style=color:#a6e22e>toLowerCase</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>validateHeadersInterceptor</span>(<span style=color:#a6e22e>config</span>: <span style=color:#66d9ef>InternalAxiosRequestConfig</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>InternalAxiosRequestConfig</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Get the headers we are sending in the requests
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>headers</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>headers</span>).<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>header</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>header</span>.<span style=color:#a6e22e>toLowerCase</span>())
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Get the headers to send are not in the allowed list
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>invalidHeaders</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>filter</span>((<span style=color:#a6e22e>header</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>allowedCorsHeaders</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>header</span>))
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>invalidHeaders</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>msg</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`Header(s): </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>invalidHeaders</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39;, &#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74> are not allowed.`</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#a6e22e>msg</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>config</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>validateHeadersInterceptor</code> function gets the <code>config</code> (the current request config) and checks if there are some unexpected headers, if there are thrown an error let the developer know she/he is using an unexpected header.</p><p>Using the interceptor is easier as do the:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>interceptors</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>validateHeadersInterceptor</span>)
</span></span></code></pre></div><h2 id=the-interceptors-order>The interceptor&rsquo;s order</h2><p>You should know that when you have multiple interceptors, the execution order is the inverse of the &ldquo;use&rdquo; order</p><p>For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>interceptors</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>interceptor1</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>interceptors</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>interceptor2</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>interceptors</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>validateHeadersInterceptor</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>interceptors</span>.<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>interceptor3</span>)
</span></span></code></pre></div><p>the execution order will be <code>interceptor3</code>, <code>validateHeadersInterceptor</code>, <code>interceptor2</code> and <code>interceptor1</code>. In our <code>validateHeadersInterceptor</code> case we want to check even if another interceptor adds an invalid header. In the example if <code>interceptor1</code> or <code>interceptor2</code> add a header to the request we will not notice it as the validator was executed before.</p><p>We should ensure our interceptor is &ldquo;used&rdquo; first, before any other interceptor.</p></div></div><aside class=post__nav-wrapper><div class=wrapper-1200><div class="post-nav post-nav--prev"><a class=post-nav__link href="https://sergiocarracedo.es/circular-dependencies/?ref=footer"><div class="post-nav__cover btn btn--img btn--hover-parent"><img alt=.Next.Title src=/circular-dependencies/pexels-miriam-alonso-7585854_hu7588756417622133273.jpg></div><div class=post-nav__title>Detecting circular dependencies in Javascript...</div></a></div><div class=blog-link><a class="btn btn--outlined" href=https://sergiocarracedo.es/blog>All Blog posts</a></div><div class="post-nav post-nav--next"><a class=post-nav__link href="https://sergiocarracedo.es/monsgeek-m5-custom-keybord-review/?ref=footer"><div class="post-nav__cover btn btn--img btn--hover-parent"><img alt=.Prev.Title class=post-nav__cover src=/monsgeek-m5-custom-keybord-review/cover_hu5211097213445964744.jpg></div><div class=post-nav__title>Monsgeek M5 custom keyboard review</div></a></div></div><div class="wrapper-1200 post__nav-years"><ul class=years><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2024>2024</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2023>2023</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2022>2022</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2021>2021</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2020>2020</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2019>2019</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2018>2018</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2017>2017</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2016>2016</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2015>2015</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2013>2013</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2012>2012</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2011>2011</a></li><li><a class=link href=https://sergiocarracedo.es/blog/by-year#2010>2010</a></li></ul></div></aside><aside class=post__search-wrapper><div class=wrapper-1200>Search in <strong>140</strong> blog posts:<form class="search-form search-form--dark search-form--l" action=https://sergiocarracedo.es/search method=get><label hidden for=search-input>Search</label>
<input type=text id=search-input name=query placeholder=Search class=search-form__input>
<button class=search-form__button>
<i class="fas fa-search"></i></button></form></div></aside><aside class=post__comments><div class=wrapper-1200><div id=disqus_thread>To show the comments is mandatory accept cookie policy.</div></div></aside></article></div><footer class="web-footer background-paper-secondary"><div class=wrapper-1200><div class=web-footer__left><div class=me><div class=me__avatar><img alt="Sergio Carracedo" src=/i/sergiocarracedo_hu3613990337080381956.jpg></div><div class=me__titles><h1>Sergio Carracedo</h1><h2>Senior Fullstack developer.</h2><h3>Always learning, cats, good conversations and small details lover.</h3></div></div></div><div class=web-footer__right><nav role=main class=menu><ul><li class=menu__item><a href=https://sergiocarracedo.es/>Home</a></li><li class=menu__item><a href=https://sergiocarracedo.es/blog>Blog</a></li></ul></nav><div class=social><a class=social__link href=http://www.linkedin.com/in/sergiocarracedo target=_blank title=LinkedIn style=animation-delay:2s><i class="fab fa-linkedin"></i>
</a><a class=social__link href=mailto:hi+blog@sergiocarracedo.es target=_blank title=Email style=animation-delay:1.9333333333333333s><i class="fas fa-envelope"></i>
</a><a class=social__link href=https://github.com/sergiocarracedo target=_blank title=GitHub style=animation-delay:1.8666666666666667s><i class="fab fa-github"></i>
</a><a class=social__link href=https://www.drupal.org/u/sergiocarracedo target=_blank title=Drupal style=animation-delay:1.8s><i class="fab fa-drupal"></i>
</a><a class=social__link href=https://www.twitter.com/sergiocarracedo target=_blank title=Twitter style=animation-delay:1.7333333333333334s><i class="fab fa-twitter"></i>
</a><a class=social__link href=http://www.last.fm/user/gasman40 target=_blank title=Last.fm style=animation-delay:1.6666666666666667s><i class="fab fa-lastfm"></i>
</a><a class=social__link href=http://sergiocarracedo.tumblr.com/ target=_blank title=Tumblr style=animation-delay:1.6s><i class="fab fa-tumblr"></i></a></div></div></div></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-87X78TXEGE"></script><script>function runGA(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-87X78TXEGE")}</script><script>function runDisqus(){(function(){var e=document,t=e.createElement("script");t.src="https://sergiocarracedo.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()}</script><script src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js></script><script>window.addEventListener("load",function(){window.cookieconsent.initialise({palette:{popup:{background:"#004262",text:"#fff"},button:{background:"#8ec760",text:"#ffffff"}},type:"opt-out",content:{message:"Este sitio usa cookies propias y de terceros para mejorar la experiencia de usuario y esas cosas.",allow:"Ok, continua",deny:"Nada de cookies",link:"Saber más",href:"https://sergiocarracedo.es/cookies"},onStatusChange:function(e){e=="allow"&&runCookiesAllowed()},onInitialise:function(e){e=="allow"&&runCookiesAllowed()}})})</script><script>addEventListener("scroll",e=>{let t=document.getElementsByTagName("body")[0];t&&window.scrollY>10?t.classList.add("not-in-top"):t.classList.remove("not-in-top")});function runCookiesAllowed(){runGA(),runDisqus()}</script><script integrity="sha256-iiQa3rTjie3Ydsr4WEu2+aLDTaxKKVR3ZTwTYrRUjXs=" src=https://sergiocarracedo.es/js/theme.8a241adeb4e389edd876caf8584bb6f9a2c34dac4a295477653c1362b4548d7b.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script integrity="sha256-LVPRt2Ca+MpOY1KztdII4jRv+U0kJBcBZEvwhZr2a4Y=" src=https://sergiocarracedo.es/js/search.2d53d1b7609af8ca4e6352b3b5d208e2346ff94d24241701644bf0859af66b86.js></script></body></html>